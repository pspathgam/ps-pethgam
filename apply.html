<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Admission Form — GPS Pethgam Wagoora (A4)</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        /* Reset */
        *{box-sizing:border-box;font-family: "Helvetica Neue", Arial, Helvetica, sans-serif}
        body{margin:16px;background:#f2f4f7;color:#222} 
        /* Center the preview area */ 
        .wrap{max-width:900px;margin:8px auto 80px;display:flex;flex-direction:column;gap:12px;align-items:center} 
        /* A4 sheet container (on-screen representation) */ 
        .a4-sheet { 
            width: 210mm; /* exact A4 width */ 
            min-height: 297mm; /* exact A4 height */ 
            background: white; 
            padding: 16mm; 
            box-shadow: 0 8px 30px rgba(0,0,0,0.12); 
            border: 1px solid #ddd; 
            position: relative; 
            color:#111; 
        } 
        /* Header */ 
        .school-header {display:flex;align-items:center;gap:12px;border-bottom:1px solid #222;padding-bottom:6px} 
        .school-logo {width:72px;height:72px;border-radius:50%;overflow:hidden;flex:0 0 72px;border:1px solid #ccc;display:flex;align-items:center;justify-content:center} 
        .school-logo img{width:100%;height:100%;object-fit:contain} 
        .school-title{flex:1;text-align:center} 
        .school-title h1{margin:0;font-size:18px;letter-spacing:0.5px} 
        .school-title p{margin:2px 0 0 0;font-size:11px;color:#333} 
        /* Form grid */ 
        .form-row{display:flex;gap:12px;align-items:center} 
        .form-group{display:flex;flex-direction:column;margin:8px 0;flex:1} 
        label{font-size:11.5px;font-weight:700;margin-bottom:6px} 
        /* underline input style (improved) */ 
        input[type="text"], input[type="tel"], input[type="date"], select, textarea { 
            border: none; 
            border-bottom: 1.5px solid #333; 
            padding:6px 8px; 
            font-size:13px; 
            outline: none; 
            background: transparent; 
        } 
        input[type="text"]::placeholder{color:#999} 
        .small{flex:0 0 120px} 
        .tiny{flex:0 0 70px} 
        /* Photo box */ 
        .photo-box { 
            width:110px;height:130px;border:1.5px dashed #555;border-radius:6px;display:flex;align-items:center;justify-content:center; 
            font-size:11px;color:#666;text-align:center;padding:8px;background:#fafafa; 
        } 
        .photo-box img{width:100%;height:100%;object-fit:cover;border-radius:4px} 
        /* Section separators and thin grid style */ 
        .section {margin-top:10px;padding-top:8px;border-top:0.5px solid #ccc} 
        .two-cols{display:flex;gap:12px} 
        .table-like{display:block;border:1px solid #aaa;padding:6px;border-radius:4px;background:#fff} 
        /* Declaration */ 
        .declaration{font-size:11px;color:#222;margin-top:14px;border:1px solid #eee;padding:10px;border-radius:4px;background:#fcfcfc} 
        /* Footer signature area */ 
        .sign-row{display:flex;gap:18px;justify-content:space-between;margin-top:18px} 
        .sig {flex:1;text-align:center;font-size:12px;color:#333} 
        /* Buttons */ 
        .actions {display:flex;gap:10px;align-items:center;justify-content:center;margin-top:14px} 
        button{padding:10px 14px;border-radius:8px;border:none;cursor:pointer;font-weight:700} 
        .btn-primary{background:#0b63d6;color:#fff} 
        .btn-ghost{background:#fff;border:1px solid #0b63d6;color:#0b63d6} 
        /* Make printable exactly A4 when printing */ 
        @media print { 
            body {background: white; margin: 0} 
            .wrap{box-shadow:none;margin:0} 
            .a4-sheet{box-shadow:none;border:none;margin:0;padding:12mm} 
        } 
        /* Mobile responsiveness for editing on small screens */ 
        @media (max-width:420px) { 
            .a4-sheet{transform:scale(0.62);transform-origin:top center} 
            .wrap{width:100%;padding:6px} 
        } 
    </style>
</head>

<body>
    <div class="wrap">
        
        <div class="a4-sheet" id="form-a4">
            
            <div class="school-header"> 
                <div class="school-logo" aria-hidden="true"> 
                    <img id="logo-img" src="assets/images/logo.png" alt="logo" onerror="this.src='logo.png'"> 
                </div> 
                <div class="school-title"> 
                    <h1>GOVERNMENT PRIMARY SCHOOL PETHGAM WAGOORA</h1> 
                    <p>Wagoora Babareshi Road Near Zonal Education Office Wagoora · Email: pspethgam@gmail.com · UDISECode: 01022202207</p> 
                </div> 
                <div style="flex:0 0 120px;text-align:center;color:#666;font-size:12px"> 
                    <div style="font-weight:700">ADMISSION FORM</div> 
                </div> 
            </div> 
            
            <div style="display:flex;gap:12px;margin-top:12px;align-items:flex-start"> 
                <div style="flex:1"> 
                    <div class="form-group"> 
                        <label>Students Full Name:</label> 
                        <input type="text" id="student-name" placeholder="First Middle Last" value=""> 
                    </div> 
                    <div class="form-group"> 
                        <label>Name As Per Aadhaar:</label> 
                        <input type="text" id="student-aadhaar-name" placeholder="As per Aadhaar"> 
                    </div> 
                    <div class="form-row"> 
                        <div class="form-group" style="flex:1"> 
                            <label>Father's Full Name:</label> 
                            <input type="text" id="father-name" placeholder=""> 
                        </div> 
                    </div> 
                    <div class="form-row"> 
                        <div class="form-group" style="flex:1"> 
                            <label>Mother's Full Name:</label> 
                            <input type="text" id="mother-name" placeholder=""> 
                        </div> 
                    </div> 
                </div> 
                <div style="width:140px;display:flex;flex-direction:column;gap:8px;align-items:center"> 
                    <div class="photo-box" id="photo-box"> 
                        <span id="photo-placeholder">AFFIX RECENT<br>PASSPORT SIZE<br>PHOTO</span> 
                    </div> 
                    <input type="file" id="photo-input" accept="image/*"> 
                </div> 
            </div> 
            
            <div class="section"> 
                <div class="form-row"> 
                    <div class="form-group"> 
                        <label>Residence:</label> 
                        <input type="text" id="residence" placeholder="Village / Locality / Street"> 
                    </div> 
                    <div class="form-group small"> 
                        <label>District:</label> 
                        <input type="text" id="district" placeholder="Baramulla"> 
                    </div> 
                </div> 
                <div class="form-row"> 
                    <div class="form-group small"> 
                        <label>Father's Cell No.:</label> 
                        <input type="tel" id="father-contact" placeholder="10 digits"> 
                    </div> 
                    <div class="form-group small"> 
                        <label>Mother's Cell No.:</label> 
                        <input type="tel" id="mother-contact" placeholder=""> 
                    </div> 
                </div> 
                <div class="form-row"> 
                    <div class="form-group"> 
                        <label>Aadhaar Number:</label> 
                        <input type="text" id="student-aadhaar" placeholder="0000 0000 0000"> 
                    </div> 
                    <div class="form-group tiny"> 
                        <label>Date of Birth:</label> 
                        <input type="date" id="dob"> 
                    </div> 
                </div> 
                <div class="form-row"> 
                    <div class="form-group small"> 
                        <label>Bank Account Number:</label> 
                        <input type="text" id="bank-account" placeholder=""> 
                    </div> 
                    <div class="form-group small"> 
                        <label>Bank Name:</label> 
                        <input type="text" id="bank-name" placeholder=""> 
                    </div> 
                    <div class="form-group small"> 
                        <label>IFSC Code:</label> 
                        <input type="text" id="ifsc-code" placeholder=""> 
                    </div> 
                </div> 
                <div class="form-row"> 
                    <div class="form-group small"> 
                        <label>Category:</label> 
                        <select id="category"> 
                            <option>GENERAL</option><option>ST</option><option>SC</option><option>OBC</option> 
                        </select> 
                    </div> 
                    <div class="form-group tiny"> 
                        <label>Blood Group:</label> 
                        <input type="text" id="blood-group" placeholder="A+"> 
                    </div> 
                    <div class="form-group"> 
                        <label>Ration Card Number:</label> 
                        <input type="text" id="ration-card" placeholder=""> 
                    </div> 
                </div> 
                <div class="form-row"> 
                    <div class="form-group small"> 
                        <label>Class Joining:</label> 
                        <input type="text" id="class-joining" placeholder="1st"> 
                    </div> 
                    <div class="form-group small"> 
                        <label>PEN Number (if transf.):</label> 
                        <input type="text" id="pen-number" placeholder=""> 
                    </div> 
                </div> 
            </div> 
            
            <div class="declaration"> 
                <strong>Parents Declaration:</strong> 
                <p style="margin:6px 0 0 0; font-size:12px"> I do hereby declare that the above information provided by me is true to the best of my knowledge and belief. I further declare that I will abide by the rules and regulations laid down by the school and the department from time to time and will co-operate with the institution for the betterment of my ward and institution when sought. I hereby consent to provide the AADHAAR for the demographic authentication of the student. (Agreed: <em>tick box on portal</em>) </p> 
            </div> 
            
            <div style="margin-top:12px;border-top:1px dashed #ccc;padding-top:10px"> 
                <div style="font-weight:700;margin-bottom:6px;font-size:12px">For Office Use Only</div> 
                <div style="font-size:12px;color:#333"> The Student is admitted to Class ______ under Admission No. ______ on ________. All required documents (Birth Certificate, Residence Proof and Transfer Certificate (if applicable)) have been verified and found satisfactory. </div> 
                <div class="sign-row"> 
                    <div class="sig">Signature of Parent</div> 
                    <div class="sig">Sig. of Adm. Incharge</div> 
                    <div class="sig">Sig. of Headmaster</div> 
                </div> 
            </div> 
        </div>
        
        <div class="actions">
            <button id="download-pdf" class="btn-primary">Generate A4 PDF</button>
            <button id="reset-form" class="btn-ghost">Reset Form</button>
        </div>
        <p style="font-size:12px;color:#555">Tip: For best results on mobile, rotate to portrait and tap "Generate A4 PDF".</p>

    </div>

    <script>
        (function(){ 
            // photo preview 
            const photoInput = document.getElementById('photo-input'); 
            const photoBox = document.getElementById('photo-box'); 
            const photoPlaceholder = document.getElementById('photo-placeholder'); 
            let photoDataURL = null; 
            
            photoInput.addEventListener('change', function(e){ 
                const file = e.target.files[0]; 
                if (!file) return; 
                const reader = new FileReader(); 
                
                reader.onload = function(ev){ 
                    photoDataURL = ev.target.result; 
                    // show preview 
                    photoBox.innerHTML = ''; 
                    const img = document.createElement('img'); 
                    img.src = photoDataURL; 
                    photoBox.appendChild(img); 
                }; 
                reader.readAsDataURL(file); 
            }); 
            
            // Reset form 
            document.getElementById('reset-form').addEventListener('click', function(){ 
                // simple reset all inputs 
                const inputs = document.querySelectorAll('#form-a4 input, #form-a4 select, #form-a4 textarea'); 
                inputs.forEach(i => { 
                    if (i.type === 'file') i.value = ''; 
                    else i.value = ''; 
                }); 
                // reset photo 
                photoBox.innerHTML = '<span id="photo-placeholder">AFFIX RECENT<br>PASSPORT SIZE<br>PHOTO</span>'; 
                photoDataURL = null; 
            }); 
            
            // PDF Generation 
            document.getElementById('download-pdf').addEventListener('click', async function(){ 
                // small pre-validations (you can expand) 
                const name = document.getElementById('student-name').value.trim(); 
                if (!name) { 
                    if(!confirm('Student name is empty. Continue to generate PDF?')) return; 
                } 
                
                // Use html2canvas to render the .a4-sheet exactly as shown 
                const element = document.getElementById('form-a4'); 
                // apply a temporary white background to avoid transparency issues 
                element.style.background = '#fff'; 
                
<script>
let currentStep = 1;
const totalSteps = 4; // Total steps before final confirmation
const formSections = document.querySelectorAll('.form-section');
const steps = document.querySelectorAll('.step');
const prevBtn = document.getElementById('prev-btn');
const nextBtn = document.getElementById('next-btn');
const submitBtn = document.getElementById('submit-btn');

// --- Multi-Step Navigation Logic ---

function updateDisplay() {
    // Standard navigation update logic goes here (as previously defined)
    formSections.forEach(section => section.classList.remove('active'));
    const currentSectionId = currentStep <= totalSteps ? `step-${currentStep}` : 'step-final';
    const currentSection = document.getElementById(currentSectionId);
    if (currentSection) {
        currentSection.classList.add('active');
    }

    steps.forEach((step, index) => {
        step.classList.remove('active', 'done');
        if (index + 1 < currentStep) {
            step.classList.add('done');
        } else if (index + 1 === currentStep && currentStep <= totalSteps) {
            step.classList.add('active');
        } else if (currentStep > totalSteps) {
             step.classList.add('done');
        }
    });

    prevBtn.style.display = currentStep > 1 && currentStep <= totalSteps ? 'block' : 'none';
    nextBtn.style.display = currentStep < totalSteps ? 'block' : 'none';
    submitBtn.style.display = currentStep === totalSteps ? 'block' : 'none';

    if (currentStep === 1) {
        nextBtn.disabled = !document.getElementById('declare-check').checked;
    } else {
        nextBtn.disabled = false;
    }

    const portalContainer = document.querySelector('.portal-container');
    if (portalContainer) {
        portalContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
}

function validateStep(stepIndex) {
    // Standard validation logic goes here (as previously defined)
    if (stepIndex === 1 && !document.getElementById('declare-check').checked) {
        alert("You must accept the Parental Declaration to proceed.");
        return false;
    }
    if (stepIndex === 3 && !document.getElementById('apaar-check').checked) {
        alert("You must provide consent for APAAR ID generation to proceed.");
        return false;
    }
    
    const currentSection = document.getElementById(`step-${stepIndex}`);
    if (!currentSection) return true; 

    const inputs = currentSection.querySelectorAll('input:required, select:required, textarea:required');
    let isValid = true;
    
    inputs.forEach(input => {
        if (!input.checkValidity()) {
            input.reportValidity();
            isValid = false;
        }
    });
    return isValid;
}

function nextStep(direction) {
    if (direction === 1) {
        if (currentStep <= totalSteps && !validateStep(currentStep)) {
            return;
        }
    }
    currentStep += direction;
    
    if (currentStep > totalSteps) {
        currentStep = totalSteps; 
        return; 
    } else if (currentStep < 1) {
        currentStep = 1;
    }
    
    updateDisplay();
}

// --- NEW HTML-TO-PDF GENERATION FUNCTION ---

/**
 * Generates a PDF from a given HTML element using html2canvas.
 * @param {string} elementId - The ID of the HTML element to capture.
 * @param {string} filenamePrefix - The prefix for the downloaded PDF file.
 */
async function generatePDFFromHTML(elementId, filenamePrefix) {
    const element = document.getElementById(elementId);
    if (!element) {
        console.error(`Element with ID ${elementId} not found. Skipping PDF generation.`);
        return false;
    }

    // Temporarily set background to white for clear canvas capture
    element.style.background = '#fff';

    const scale = 2; // For high resolution
    const canvas = await html2canvas(element, { 
        scale: scale, 
        useCORS: true, 
        allowTaint: true, 
        logging: false, 
        windowWidth: element.scrollWidth, 
        windowHeight: element.scrollHeight 
    }); 

    // Revert background color after capture (optional)
    element.style.background = '';

    const { jsPDF } = window.jspdf; 
    const pdf = new jsPDF({ 
        unit: 'mm', 
        format: 'a4', 
        orientation: 'portrait' 
    }); 
    
    // Calculate dimensions
    const pdfWidth = 210; 
    const imgProps = { 
        width: canvas.width, 
        height: canvas.height 
    }; 
    const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width; 
    
    pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 0, 0, pdfWidth, pdfHeight); 
    
    // Multi-page logic (simplified from your provided code)
    if (pdfHeight > 297) { 
        let pageCount = Math.ceil(pdfHeight / 297); 
        const pagePx = Math.floor(297 * (canvas.width / pdfWidth));
        
        for (let i = 1; i < pageCount; i++) { 
            const sx = 0; 
            const sy = i * pagePx; 
            const sw = canvas.width; 
            const sh = Math.min(pagePx, canvas.height - sy); 
            
            const pageCanvas = document.createElement('canvas'); 
            const ctx = pageCanvas.getContext('2d'); 

            pageCanvas.width = sw; 
            pageCanvas.height = sh; 
            ctx.clearRect(0,0, sw, sh); 
            ctx.drawImage(canvas, sx, sy, sw, sh, 0, 0, sw, sh); 
            
            pdf.addPage(); 
            const partHeightMM = (sh * pdfWidth) / canvas.width; 
            pdf.addImage(pageCanvas.toDataURL('image/png'), 'PNG', 0, 0, pdfWidth, partHeightMM); 
        } 
    } 
    
    // Save file
    const studentName = document.getElementById('student-name').value.trim();
    const studentSafe = studentName ? studentName.replace(/\s+/g, '_') : 'student';
    pdf.save(`${studentSafe}_${filenamePrefix}.pdf`); 
    
    return true; 
}


// --- FINAL SUBMISSION FUNCTION (Triggers both PDFs) ---

async function finalSubmit() {
    // You can re-enable validation for file uploads here if required
    // if (!validateStep(4)) { return; } 

    // 1. Generate Admission Form PDF
    const admissionSuccess = await generatePDFFromHTML('form-admission', 'Admission_Form');

    // 2. Generate APAAR Consent Form PDF
    const apaarSuccess = await generatePDFFromHTML('form-apaar', 'APAAR_Consent');

    if (admissionSuccess && apaarSuccess) {
        currentStep = 5; // Move to the final confirmation step
        updateDisplay();
        alert("Application Submitted Online! Please check your downloads folder for the generated forms.");
    } else {
        // This will only happen if the HTML elements are not found
        console.error("PDF generation failed. Check if 'form-admission' and 'form-apaar' elements exist.");
        alert("An error occurred during PDF generation. Please ensure all form sections are present.");
    }
}

// Initial setup
document.addEventListener('DOMContentLoaded', updateDisplay);

// Re-enable next button if declaration is checked on step 1
document.getElementById('declare-check').addEventListener('change', () => {
    if (currentStep === 1) {
        nextBtn.disabled = !document.getElementById('declare-check').checked;
    }
});

// Update display to start at Step 1
currentStep = 1;
updateDisplay();
      /**
 * Copies data from the multi-step form inputs to the hidden PDF template's inputs.
 */
function transferDataToPDFTemplate() {
    // === Data Transfer for Admission Form (form-admission) ===
    
    // Copy student details
    document.querySelector('#form-admission #student-name').value = document.getElementById('student-name').value;
    document.querySelector('#form-admission #student-aadhaar-name').value = document.getElementById('student-name').value; // Assuming same name
    document.querySelector('#form-admission #father-name').value = document.getElementById('father-name').value;
    document.querySelector('#form-admission #mother-name').value = document.getElementById('mother-name').value;

    // Copy contact and address
    document.querySelector('#form-admission #residence').value = document.getElementById('residence').value;
    document.querySelector('#form-admission #district').value = document.getElementById('district').value;
    document.querySelector('#form-admission #father-contact').value = document.getElementById('father-contact').value;
    document.querySelector('#form-admission #mother-contact').value = document.getElementById('mother-contact').value; // Assuming this field exists in your multi-step form
    
    // Copy official details
    document.querySelector('#form-admission #student-aadhaar').value = document.getElementById('student-aadhaar').value;
    document.querySelector('#form-admission #dob').value = document.getElementById('dob').value;
    document.querySelector('#form-admission #bank-account').value = document.getElementById('bank-account').value;
    document.querySelector('#form-admission #ifsc-code').value = document.getElementById('ifsc-code').value;
    document.querySelector('#form-admission #category').value = document.getElementById('category').value;
    document.querySelector('#form-admission #blood-group').value = document.getElementById('blood-group').value;
    document.querySelector('#form-admission #ration-card').value = document.getElementById('ration-card').value;
    document.querySelector('#form-admission #class-joining').value = document.getElementById('class-joining').value;
    document.querySelector('#form-admission #pen-number').value = document.getElementById('pen-number').value;
    
    // NOTE: You need a similar block of code here for the APAAR Consent Form
    // If your APAAR form template fields have IDs, you would map them:
    // document.querySelector('#form-apaar #apaar-student-name').value = document.getElementById('student-name').value;
    
    // Photo transfer (Assuming 'photoDataURL' is stored globally by the photo input event listener)
    if (window.photoDataURL) {
        const img = document.createElement('img');
        img.src = window.photoDataURL;
        document.querySelector('#form-admission #photo-box').innerHTML = '';
        document.querySelector('#form-admission #photo-box').appendChild(img);
    }
}
            
</script>
</body>
</html>
